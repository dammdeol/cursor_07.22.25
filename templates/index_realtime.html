{% extends "base.html" %}

{% block title %}Inicio Real-Time - Catálogo Ralph Wilson{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section bg-primary text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="display-4 fw-bold mb-4">
                    Catálogo Ralph Wilson
                    {% if use_realtime %}
                        <span class="badge bg-success fs-6 ms-2">
                            <i class="fas fa-broadcast-tower"></i> TIEMPO REAL
                        </span>
                    {% endif %}
                </h1>
                <p class="lead mb-4">
                    {% if use_realtime %}
                        Explora nuestro catálogo con conexión directa a ralphwilson.com.mx. 
                        Datos siempre actualizados y detección automática de productos descontinuados.
                    {% else %}
                        Explora nuestro catálogo desde el cache local. 
                        Datos almacenados para acceso rápido sin conexión.
                    {% endif %}
                </p>
                <div class="d-flex gap-3">
                    <a href="{{ url_for('products', realtime='true' if use_realtime else 'false') }}" 
                       class="btn {% if use_realtime %}btn-success{% else %}btn-light{% endif %} btn-lg">
                        <i class="fas fa-{% if use_realtime %}satellite-dish{% else %}eye{% endif %}"></i> 
                        Explorar Productos
                    </a>
                    <a href="{{ url_for('products', realtime='true' if not use_realtime else 'false') }}" 
                       class="btn btn-outline-light btn-lg">
                        <i class="fas fa-{% if use_realtime %}database{% else %}broadcast-tower{% endif %}"></i>
                        Cambiar a {% if use_realtime %}Cache{% else %}Tiempo Real{% endif %}
                    </a>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="text-center">
                    {% if use_realtime %}
                        <i class="fas fa-satellite-dish display-1 opacity-75"></i>
                        <p class="mt-3">Conexión Directa</p>
                    {% else %}
                        <i class="fas fa-database display-1 opacity-75"></i>
                        <p class="mt-3">Cache Local</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Connection Status Section -->
<section class="py-4 {% if use_realtime %}bg-success{% else %}bg-info{% endif %} text-white">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <div class="d-flex align-items-center">
                    <i class="fas fa-{% if use_realtime %}wifi{% else %}hdd{% endif %} fa-2x me-3"></i>
                    <div>
                        <h5 class="mb-0">
                            {% if use_realtime %}
                                Modo Tiempo Real Activo
                            {% else %}
                                Modo Cache Local Activo
                            {% endif %}
                        </h5>
                        <small>
                            {% if use_realtime %}
                                Datos obtenidos directamente desde ralphwilson.com.mx
                            {% else %}
                                Usando datos almacenados localmente para acceso rápido
                            {% endif %}
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-end">
                {% if use_realtime %}
                    <div id="connectionStatus">
                        <i class="fas fa-spinner fa-spin"></i> Verificando conexión...
                    </div>
                {% else %}
                    <span class="badge bg-light text-dark">
                        <i class="fas fa-check"></i> Cache Disponible
                    </span>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Statistics Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-4 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <i class="fas fa-box-open fa-3x {% if use_realtime %}text-success{% else %}text-primary{% endif %} mb-3"></i>
                        <h3 class="card-title">
                            {% if stats.total_products == 'Live Data' %}
                                <i class="fas fa-satellite-dish text-success"></i> LIVE
                            {% else %}
                                {{ stats.total_products }}
                            {% endif %}
                        </h3>
                        <p class="card-text">Productos Totales</p>
                        {% if use_realtime %}
                            <small class="text-muted">
                                <i class="fas fa-broadcast-tower"></i> Tiempo Real
                            </small>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <i class="fas fa-list fa-3x text-warning mb-3"></i>
                        <h3 class="card-title">{{ stats.categories|length }}</h3>
                        <p class="card-text">Categorías</p>
                        {% if use_realtime %}
                            <small class="text-muted">
                                <i class="fas fa-satellite-dish"></i> En Vivo
                            </small>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <i class="fas fa-{% if use_realtime %}satellite-dish{% else %}hdd{% endif %} fa-3x text-info mb-3"></i>
                        <h3 class="card-title">
                            {% if use_realtime %}
                                LIVE
                            {% else %}
                                CACHE
                            {% endif %}
                        </h3>
                        <p class="card-text">Fuente de Datos</p>
                        <small class="text-muted">
                            {% if use_realtime %}
                                ralphwilson.com.mx
                            {% else %}
                                Base de datos local
                            {% endif %}
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Categories Section -->
{% if stats.categories %}
<section class="py-5">
    <div class="container">
        <h2 class="text-center mb-5">
            Categorías Principales
            {% if use_realtime %}
                <span class="badge bg-success ms-2">LIVE</span>
            {% endif %}
        </h2>
        <div class="row">
            {% for category_name, count in stats.categories %}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 shadow-sm category-card">
                    <div class="card-body text-center">
                        <i class="fas fa-layer-group fa-2x {% if use_realtime %}text-success{% else %}text-primary{% endif %} mb-3"></i>
                        <h5 class="card-title">{{ category_name }}</h5>
                        <p class="card-text text-muted">
                            {% if count == '?' %}
                                <i class="fas fa-satellite-dish"></i> En tiempo real
                            {% else %}
                                {{ count }} productos
                            {% endif %}
                        </p>
                        <a href="{{ url_for('products', category=category_name, realtime='true' if use_realtime else 'false') }}" 
                           class="btn {% if use_realtime %}btn-outline-success{% else %}btn-outline-primary{% endif %}">
                            Ver Productos
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Features Section -->
<section class="py-5 bg-light">
    <div class="container">
        <h2 class="text-center mb-5">Características del Sistema</h2>
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center">
                        <i class="fas fa-satellite-dish fa-3x text-success mb-3"></i>
                        <h5 class="card-title">Tiempo Real</h5>
                        <p class="card-text">
                            Conexión directa con ralphwilson.com.mx para obtener 
                            datos siempre actualizados sin necesidad de almacenamiento local.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center">
                        <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
                        <h5 class="card-title">Detección Automática</h5>
                        <p class="card-text">
                            Identifica automáticamente productos descontinuados 
                            basándose en imágenes placeholder y otros indicadores.
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center">
                        <i class="fas fa-chart-line fa-3x text-info mb-3"></i>
                        <h5 class="card-title">Progreso Visual</h5>
                        <p class="card-text">
                            Barra de progreso en tiempo real durante el scraping 
                            con estimación de tiempo y conteo de productos.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Call to Action Section -->
<section class="py-5 {% if use_realtime %}bg-success{% else %}bg-primary{% endif %} text-white">
    <div class="container text-center">
        <h2 class="mb-4">¿Listo para explorar el catálogo?</h2>
        <p class="lead mb-4">
            {% if use_realtime %}
                Accede a datos en tiempo real directamente desde el sitio web oficial
            {% else %}
                Navega por los productos almacenados en cache para acceso rápido
            {% endif %}
        </p>
        <div class="d-flex gap-3 justify-content-center">
            <a href="{{ url_for('products', realtime='true' if use_realtime else 'false') }}" 
               class="btn btn-light btn-lg">
                <i class="fas fa-search"></i> Buscar Productos
            </a>
            <a href="{{ url_for('admin') }}" class="btn btn-outline-light btn-lg">
                <i class="fas fa-cog"></i> Panel de Control
            </a>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
{% if use_realtime %}
// Test connection status
function updateConnectionStatus() {
    const statusDiv = document.getElementById('connectionStatus');
    
    fetch('/api/products/realtime?limit=1')
        .then(response => response.json())
        .then(data => {
            if (data.products !== undefined) {
                statusDiv.innerHTML = '<i class="fas fa-wifi"></i> Conectado';
            } else {
                throw new Error('No data');
            }
        })
        .catch(error => {
            statusDiv.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Sin conexión';
        });
}

// Update connection status every 30 seconds
updateConnectionStatus();
setInterval(updateConnectionStatus, 30000);
{% endif %}

// Add hover effects to category cards
document.querySelectorAll('.category-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-10px)';
        this.style.transition = 'transform 0.3s ease';
    });
    
    card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
    });
});
</script>
{% endblock %}
